<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 20px;
            background-color: #212529;
            padding: 10px;
            margin: 0;
        }
        td {
            text-align: center;
            border-left: 3px dotted white;
            border-bottom: 2px solid white;
            border-color: white;
            height: 30px;
            padding: 0px;
            margin: 0px;
            font-size: 15px;
        
        }
        th {
            font-size: 15px;
        }
        .btn {
            margin-right: 10px;
            margin-top: 5px;
        }
        .labs {
            display: inline-block;
            width: 150px;
        }
    </style>
</head>
<body>
 

<!-- <input id="username">
<button id="up-butt">UP</button> -->
<!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter" onclick="FillTboxes(null)">Add New Record</button> -->
<div class=" mt-3 w-100">


    <!-- Search Section -->
    <div class="input-group mb-3">
        <input id="SearchBar" type="text" class="form-control" placeholder="Search A Record" aria-label="Recipient's username" aria-describedby="basic-addon2">
        <div class="input-group-append">
            <select class="custom-select ml-3" id="CategorySelected">
                <option selected value="1">By Name</option>
                <option value="2">$ Spent</option>
                <option value="3">$ Gained</option>
                <option value="4">Midas Points</option>
                <option value="5">Coconut Wins</option>
                <option value="6">Coconuts Lost</option>
                <option value="7">Pyramid Wins</option>
                <option value="8">Pyramids Lost</option>
                <option value="9">Games Played</option>
                
              </select>
          <button id="SearchBtn" class="btn btn-outline-primary ml-3" type="button">Search</button>
        </div>
      </div>

    <table class="table table-dark text-white w-100">
        <thread>
            <th>#</th>
            <th>Username</th>
            <th>$ Spent</th>
            <th>$ Gained</th>
            <th>Midas Points</th>
            <th>Coconut Wins</th>
            <th>Coconuts Lost</th>
            <th>Pyramid Wins</th>
            <th>Pyramids Lost</th>
            <th>Games Played</th>
            <th>Control Center</th>
        </thread>

        <tbody id="tbody1">
            
        </tbody>
    </table>
</div>


<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <label class="labs">Username: </label>
            <input type="text" id="NameMod" value=" "> <br>
            <label class="labs">$ Spent: </label>
            <input type="text" id="SpentMod" value="0"> <br>
            <label class="labs">$ Gained: </label>
            <input type="text" id="GainedMod" value="0"> <br>
            <label class="labs">Midas Points: </label>
            <input type="text" id="MidasPointsMod" value="0"> <br>
            <label class="labs">Coconut Wins: </label>
            <input type="text" id="CoconutWinsMod" value="0"> <br>
            <label class="labs">Coconuts Lost: </label>
            <input type="text" id="CoconutsLostMod" value="0"> <br>
            <label class="labs">Pyramid Wins: </label>
            <input type="text" id="PyramidWinsMod" value="0"> <br>
            <label class="labs">Pyramids Lost: </label>
            <input type="text" id="PyramidsLostMod" value="0"> <br>
            <label class="labs">Games Played: </label>
            <input type="text" id="GamesPlayedMod" value="0"> <br>
        </div>
        <div class="modal-footer">
          <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
          <button id="AddModBtn" type="button" class="btn btn-primary" onclick="AddStd()">Add New Record</button>
          <button id="UpdModBtn" type="button" class="btn btn-success" onclick="UpdStd()">Update Record</button>
          <button id="DelModBtn" type="button" class="btn btn-danger" onclick="DelStd()">Delete Record</button>
        </div>
      </div>
    </div>
  </div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-database.js"></script> 


<script id="MainScript">
    var firebaseConfig = {
  apiKey: "AIzaSyC-itolTF-ceIQ9Vx5rqNU7zhZwYtBe1bo",
  authDomain: "card-games-cd22a.firebaseapp.com",
  databaseURL: "https://card-games-cd22a-default-rtdb.firebaseio.com",
  projectId: "card-games-cd22a",
  storageBucket: "card-games-cd22a.appspot.com",
  messagingSenderId: "1073500076157",
  appId: "1:1073500076157:web:3d7738b212b41c02dbd914",
  measurementId: "G-ZHK89NTGE7"
};

  firebase.initializeApp(firebaseConfig);
  var stdNo;
  //GET ALL DATA

  function SelectAllData() {
    document.getElementById('tbody1').innerHTML="";
    stdNo=0;
    firebase.database().ref('saved_data').once('value',
    function(AllRecords){
        AllRecords.forEach(

        function(CurrentRecord){
            var name = CurrentRecord.val().username;
            var spent = CurrentRecord.val().spent;
            var gained = CurrentRecord.val().gained;
            var midaspoints = CurrentRecord.val().midaspoints;
            var coconutwin = CurrentRecord.val().coconutwin;
            var coconutslost = CurrentRecord.val().coconutslost;
            var pyramidwin = CurrentRecord.val().pyramidwin;
            var pyramidslost = CurrentRecord.val().pyramidslost;
            var gamesplayed = CurrentRecord.val().gamesplayed;
            // var percent = CurrentRecord.val().percent;
            AddItemsToTable(name,spent,gained,midaspoints,coconutwin,coconutslost,pyramidwin,pyramidslost,gamesplayed);
        }
        ); 
    });
  }

  window.onload = SelectAllData();


//FILLING THE TABLE

var stdList =[];
            function AddItemsToTable(name,spent,gained,midaspoints,coconutwin,coconutslost,pyramidwin,pyramidslost,gamesplayed){
                var tbody = document.getElementById('tbody1');
                var trow = document.createElement('tr');
                var td1 = document.createElement('td');
                var td2 = document.createElement('td');
                var td3 = document.createElement('td');
                var td4 = document.createElement('td');
                var td5 = document.createElement('td');
                var td6 = document.createElement('td');
                var td7 = document.createElement('td');
                var td8 = document.createElement('td');
                var td9 = document.createElement('td');
                var td10 = document.createElement('td');
                stdList.push([name,spent,gained,midaspoints,coconutwin,coconutslost,pyramidwin,pyramidslost,gamesplayed]);
                td1.innerHTML= ++stdNo;
                td2.innerHTML= name;
                td3.innerHTML= '$' + spent;
                td4.innerHTML= '$' + gained;
                td5.innerHTML= midaspoints;
                td6.innerHTML= coconutwin;
                td7.innerHTML= coconutslost;
                td8.innerHTML= pyramidwin;
                td9.innerHTML= pyramidslost;
                td10.innerHTML= gamesplayed;
                td2.classList += "nameField"
                td3.classList += "spentField"
                td4.classList += "gainedField"
                td5.classList += "midaspointsField"
                td6.classList += "coconutwinField"
                td7.classList += "coconutslostField"
                td8.classList += "pyramidwinField"
                td9.classList += "pyramidslostField"
                td10.classList += "gamesField"
                // td7.innerHTML= parseFloat(wins)+parseFloat(losses);
                // td8.innerHTML= Math.round(parseFloat(wins)/(parseFloat(wins)+parseFloat(losses))*100) + '%';
                trow.appendChild(td1); 
                trow.appendChild(td2); 
                trow.appendChild(td3); 
                trow.appendChild(td4); 
                trow.appendChild(td5); 
                trow.appendChild(td6); 
                trow.appendChild(td7);
                trow.appendChild(td8);
                trow.appendChild(td9);
                trow.appendChild(td10);

                var ControlDiv = document.createElement('div');
                ControlDiv.innerHTML = '<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter" onclick="FillTboxes(null)">Add New Record</button>'
                ControlDiv.innerHTML += '<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter" onclick="FillTboxes('+stdNo+')">Edit Record</button>'

                trow.appendChild(ControlDiv);
                tbody.appendChild(trow);
            }

                var ModName = document.getElementById('NameMod');
                var ModSpent = document.getElementById('SpentMod');
                var ModGained = document.getElementById('GainedMod');
                var ModMidas = document.getElementById('MidasPointsMod');
                var ModCoconut = document.getElementById('CoconutWinsMod');
                var ModCoconutsLost = document.getElementById('CoconutsLostMod');
                var ModPyramid = document.getElementById('PyramidWinsMod');
                var ModPyramidsLost = document.getElementById('PyramidsLostMod');
                var ModGamesPlayed = document.getElementById('GamesPlayedMod');

                var BTNmodAdd = document.getElementById('AddModBtn');
                var BTNmodUpd = document.getElementById('UpdModBtn');
                var BTNmodDel = document.getElementById('DelModBtn');
                

            function FillTboxes(index){
                if(index==null){
                    ModName.value = " ";
                    ModSpent.value = "0";
                    ModGained.value = "0";
                    ModMidas.value = "0";
                    ModCoconut.value = "0";
                    ModCoconutsLost.value = "0";
                    ModPyramid.value = "0";
                    ModPyramidsLost.value = "0";
                    ModGamesPlayed.value = "0";
                    ModName.disabled = false;
                    BTNmodAdd.style.display = 'inline-block';
                    BTNmodUpd.style.display = 'none';
                    BTNmodDel.style.display = 'none';
                    
                }

                else{
                    --index;
                    ModName.value = stdList[index][0];
                    ModSpent.value = stdList[index][1];
                    ModGained.value = stdList[index][2];
                    ModMidas.value = stdList[index][3];
                    ModCoconut.value = stdList[index][4];
                    ModCoconutsLost.value = stdList[index][5];
                    ModPyramid.value = stdList[index][6];
                    ModPyramidsLost.value = stdList[index][7];
                    ModGamesPlayed.value = stdList[index][8];

                    ModName.disabled = true;
                    // ModName.disabled = true; //disables editing the name
                    BTNmodAdd.style.display = 'none';
                    BTNmodUpd.style.display = 'inline-block';
                    BTNmodDel.style.display = 'inline-block';
                }
            }

            function AddStd(){
                firebase.database().ref("saved_data/"+ModName.value).set(
                    {
                        username: ModName.value,
                        spent: ModSpent.value,
                        gained: ModGained.value,
                        midaspoints: ModMidas.value,
                        coconutwin: ModCoconut.value,
                        coconutslost: ModCoconutsLost.value,
                        pyramidwin: ModPyramid.value,
                        pyramidslost: ModPyramidsLost.value,
                        gamesplayed: ModGamesPlayed.value
                    },
                    (error) => {
                        if(error){
                            alert("Record was not added, there was some problem");
                        }
                        else{
                            // alert("record was added");
                            SelectAllData();
                            $("exampleModalCenter").modal('hide');
                            location.reload();
                        }
                    }
                )
            }

            function UpdStd(){
                firebase.database().ref("saved_data/"+ModName.value).update(
                    {
                        username: ModName.value,
                        spent: ModSpent.value,
                        gained: ModGained.value,
                        midaspoints: ModMidas.value,
                        coconutwin: ModCoconut.value,
                        coconutslost: ModCoconutsLost.value,
                        pyramidwin: ModPyramid.value,
                        pyramidslost: ModPyramidsLost.value,
                        gamesplayed: ModGamesPlayed.value
                    },
                    (error) => {
                        if(error){
                            alert("Record was not Updated, there was some problem");
                        }
                        else{
                            // alert("record was Updated");
                            SelectAllData();
                            $("exampleModalCenter").modal('hide');
                            location.reload();
                        }
                    }
                )
            }

            function DelStd(){
                firebase.database().ref("saved_data/"+ModName.value).remove().then(
                    function(){
                        alert("record was Deleted");
                            SelectAllData();
                            $("exampleModalCenter").modal('hide');
                        location.reload();
                    }
                )
            }

            var searchBar = document.getElementById("SearchBar");
            var searchBtn = document.getElementById("SearchBtn");
            var category = document.getElementById("CategorySelected");
            var tbody = document.getElementById("tbody1");


            function SearchTable(Category){

                var filter = searchBar.value.toUpperCase();
                var tr = tbody.getElementsByTagName('tr');
                var found;

                for (let i = 0; i < tr.length; i++) {

                    var td = tr[i].getElementsByClassName(Category);

                    for (let j = 0; j < td.length; j++) {
                        if(td[j].innerHTML.toUpperCase().indexOf(filter) > -1){
                            found=true;
                        }
                    }

                    if(found){
                        tr[i].style.display="";
                        found=false;
                    }
                    else {
                        tr[i].style.display="none";
                    }
                    
                }

            }

            searchBtn.onclick = function(){
                if(searchBar.value=="");

                else if(category.value==1)
                SearchTable("nameField");

                else if(category.value==2)
                SearchTable("spentField");

                else if(category.value==3)
                SearchTable("gainedField");

                else if(category.value==4)
                SearchTable("midaspointsField");

                else if(category.value==5)
                SearchTable("coconutwinField");

                else if(category.value==6)
                SearchTable("coconutslostField");

                else if(category.value==7)
                SearchTable("pyramidwinField");

                else if(category.value==8)
                SearchTable("pyramidslostField");

                else if(category.value==9)
                SearchTable("gamesField");
            }

            searchBar.onkeypress = function(event){
                if(event.keyCode==13){
                    searchBtn.click();
                }

                if(event.keyCode==13 && searchBar.value===""){
                    location.reload();
                }
            }
            


           

</script>
<!-- Button trigger modal -->

  
  <!-- Modal -->
  


<!-- <table style="width:100%" id="ex-table">
    <tr id="tr">
      <th>Username</th>
      <th>$ Spent</th>
      <th>$ Gained</th>
      <th>Wins</th>
      <th>Losses</th>
      <th>Winning Percentage</th>
    </tr>
  </table> -->

  
<!-- <script type="module"> //old
    // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";
  
  
  // Your web app's Firebase configuration
  const firebaseConfig = {
     apiKey: "AIzaSyC-itolTF-ceIQ9Vx5rqNU7zhZwYtBe1bo",
     authDomain: "card-games-cd22a.firebaseapp.com",
     projectId: "card-games-cd22a",
     storageBucket: "card-games-cd22a.appspot.com",
     messagingSenderId: "1073500076157",
     appId: "1:1073500076157:web:15891e004ed49f73dbd914",
     measurementId: "G-M23HFY0L6F"
  };
  
  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  
  //get ref to database services
  const db = getDatabase(app);
  
  document.getElementById("up-butt").addEventListener('click', function(e){
   e.preventDefault();
   set(ref(db, 'saved_data/' + document.getElementById('username').value),
   {
     username: document.getElementById('username').value
   });
   
     alert("Login Sucessfull  !");
     db.ref('saved_data/').once('value', function(snapshot) {
      if (snapshot.exists()) {
        var content = '';
        snapshot.forEach(function(data) {
          var val = data.val();
          content += '<tr>';
          content += '<td>' + val.username + '</td>';
          content += '<td>' + val.spent + '</td>';
          content += '<td>' + val.gained + '</td>';
          content += '<td>' + val.lossed + '</td>';
          content += '<td>' + val.wins + '</td>';
          content += '<td>' + val.losses + '</td>';
          content += '</tr>';
        });
        $('#ex-table').append(content);
      }
    });
  })
  
  
 
  
  </script> -->


</body>
</html>